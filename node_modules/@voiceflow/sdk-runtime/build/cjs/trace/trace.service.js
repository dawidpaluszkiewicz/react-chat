"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.TraceService = void 0;
class TraceService {
    constructor(options = {}) {
        this.traces = [];
        this.registerTraces(options.traces ?? []);
    }
    registerTrace(step) {
        this.traces.push(step);
        return this;
    }
    registerTraces(steps) {
        steps.forEach((step) => this.registerTrace(step));
        return this;
    }
    async processTrace(context, response) {
        const meta = { context };
        for (const trace of response.trace) {
            const step = this.traces.find((step) => step.canHandle(trace));
            if (step) {
                // eslint-disable-next-line no-await-in-loop
                meta.context = await step.handle(meta, trace);
            }
        }
        return meta.context;
    }
}
exports.TraceService = TraceService;
